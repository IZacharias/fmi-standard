=== FMI Description Schema

This is defined in <<fmi-description-schema>>.
Additionally, the co-simulation specific element "Implementation" is defined in the next section.

==== Co-Simulation FMU (CoSimulation) [[CoSimulation]]

If the XML file defines an FMU for Co-Simulation, element "CoSimulation" must be present.
It is defined as:

image::images/cs_xml_1.png[width=80%, align="center"]

image::images/cs_xml_2.png[width=70%, align="center"]

These attributes have the following meaning (all attributes are optional with exception of `modelIdentifier`):

[cols="1,1",options="header"]
|====
|Attribute Name
|_Description_

|`modelIdentifier`
|Short class name according to C syntax, for example, "A_B_C".
Used as prefix for FMI functions if the functions are provided in C source code or in static libraries, but not if the functions are provided by a DLL/SharedObject.
`modelIdentifier` is also used as name of the static library or DLL/SharedObject.
See also <<header-files-and-naming-of-functions>>.

|`needsExecutionTool`
|If true, a tool is needed to execute the model.
The FMU just contains the communication to this tool (see <<figure-co-simulation-with-tool-coupling>>).
_[Typically, this information is only utilized for information purposes.
For example, a co-simulation master can inform the user that a tool has to be available on the computer where the slave is instantiated.
The name of the tool can be taken from attribute `generationTool` of `fmiModelDescription`.]_

|`canHandleVariableCommunicationStepSize`
|The slave can handle variable communication step size.
The communication step size (parameter communicationStepSize of `fmi3DoStep`) has not to be constant for each call.

|`canInterpolateInputs`
|The slave is able to interpolate continuous inputs.
Calling of `fmi3SetRealInputDerivatives` has an effect for the slave.

|`maxOutputDerivativeOrder`
|The slave is able to provide derivatives of outputs with maximum order.
Calling of `fmi3GetRealOutputDerivatives` is allowed up to the order defined by `maxOutputDerivativeOrder`.

|`canRunAsynchronuously`
|This flag describes the ability to carry out the `fmi3DoStep` call asynchronously.

|`canBeInstantiatedOnlyOncePerProcess`
|This flag indicates cases (especially for embedded code), where only one instance per FMU is possible. (For multiple instantiation the default is `false`; if multiple instances are needed, the FMUs must be instantiated in different processes.).

|`canNotUseMemoryManagementFunctions`
|If true, the slave uses its own functions for memory allocation and freeing only.
The callback functions `allocateMemory` and `freeMemory` given in `fmi3Instantiate` are ignored.

|`canGetAndSetFMUstate`
|If true, the environment can inquire the internal FMU state and restore it.
That is, `fmi3GetFMUstate`, `fmi3SetFMUstate`, and `fmi3FreeFMUstate` are supported by the FMU.

|`canSerializeFMUstate`
|If true, the environment can serialize the internal FMU state, in other words, `fmi3SerializedFMUstateSize`, `fmi3SerializeFMUstate`, `fmi3DeSerializeFMUstate` are supported by the FMU.
If this is the case, then flag `canGetAndSetFMUstate` must be true as well.

|`providesDirectionalDerivative`
|If true, the directional derivative of the equations at communication points can be computed with `fmi3GetDirectionalDerivative`.
|====

The flags have the following default values. +
boolean: false +
unsignedInt: 0 +

Note that if `needsExecutionTool = true`, then it is required that the original tool is available to be executed in co-simulation mode.
If `needsExecutionTool = false`, the slave is completely contained inside the FMU in source code or binary format (DLL/SharedObject).

==== Definition of Source Files (SourceFiles)

Element `SourceFiles` of `CoSimulation` is only meaningful for source code FMUs. If an FMU provides source files, the element `SourceFiles` must be present.
It must contain information on each source file that is present in the "sources" directory of the FMU and needs to be compiled in order to generate the binary of the FMU.

Element "*SourceFiles*" of `CoSimulation` is defined as:

image::images/SourceFiles_schema.png[]

The attribute of element "*SourceFile*" has the following meaning 

[cols="1,1",options="header"]
|====
|Attribute Name
|_Description_

|`platformSupportLimitedTo`
|List of supported platforms if FMU is suitable only for special platforms. If arbitrary platforms are supported, or if platform-dependence is unknown, attribute must not be added.

|====


Element `SourceFiles` contains 1..n elements `File`
The attributes of element "*File*" have the following meaning (all attributes are optional with exception of `name`):

[cols="1,1",options="header"]
|====
|Attribute Name
|_Description_

|`name`
|Name of the file including the path relative to the sources directory, using the forward slash as separator (for example: name = "myFMU.c"; name = "modelExchange/solve.c")

|`platform`
|Platform name, e.g. x86_64-windows, i686-linux,...
platform attribute must only be added if source file is platform-dependent.

|`language`
|C, C++, Fortran. Default is C.

|`languageVersion`
|Fortran77, C99, ... see Modelica standard 3.4, section 12.9

|====

==== Definition of include directories (IncludeDirectories)

The element `IncludeDirectories` is optionally present. It contains an ordered list of include paths (element `Path`) to be specified to the compiler for header file search. Search order: First one wins.

Element "*IncludeDirectories*" of `CoSimulation` is defined as:

image::images/IncludeDirectories_schema.png[]

Element `IncludeDirectories` contains 1..n elements `Path`
The attributes of element "*Path*" have the following meaning (all attributes are optional with exception of `name`):

[cols="1,1",options="header"]
|====
|Attribute Name
|_Description_

|`name`
|Name of the directory including the path relative to the sources directory, using the forward slash as separator (for example: name = "coSimulation/utils") 
Only subdirectories of the sources directory are allowed.

|`platform`
|Platform name, e.g. x86_64-windows, i686-linux,...
platform attribute must only be added if source file is platform-dependent.

|`compiler`
|Compiler, e.g. gcc, VisualStudio

|`compilerVersion`
|Compiler version, e.g. 3.2

|====

==== Definition of preprocessor definitions (PreProcessorDefinitions)

The element `PreProcessorDefinitons` is optionally present. It is only meaningful for source code FMUs.
It contains a list of compiler macros required to compile the sources. All defines must be set.

Element "*PreProcessorDefinitions*" of `CoSimulation` is defined as:

image::images/PreProcessorDefinitions_schema.png[]

Element `PreProcessorDefinitions` contains 1..n elements `Define`
The attributes of element "*Define*" have the following meaning (all attributes are optional with exception of `name`):

[cols="1,1",options="header"]
|====
|Attribute Name
|_Description_

|`name`
|Case sensitive macro name e.g. LOGLEVEL

|`value`
|Optional value of the macro, e.g. 3 or ON

|`description`
|Optional description what the behaviour is controlled by the macro.

|`platform`
|Platform name, e.g. x86_64-windows, i686-linux,...
platform attribute must only be added if source file is platform-dependent.

|`compiler`
|Compiler, e.g. gcc, VisualStudio

|`compilerVersion`
|Compiler version, e.g. 3.2

|====

==== Definition of libraries to be linked (Libraries)

The element `Libraries` is optionally present. It contains an ordered list of libraries (element `File`) to be presented to the linker. Link order: First one wins.

Element "*Libraries*" of `CoSimulation` is defined as:

image::images/Libraries_schema.png[]

Element `Libraries` contains 1..n elements `File`
The attributes of element "*File*" have the following meaning (all attributes are optional with exception of `name`):

[cols="1,1",options="header"]
|====
|Attribute Name
|_Description_

|`name`
|Name of the library to be linked with, to be found in the platform/compiler directories of the FMU.

|`platform`
|Platform name, e.g. x86_64-windows, i686-linux,...
platform attribute must only be added if source file is platform-dependent.

|`compiler`
|Compiler, e.g. gcc, VisualStudio

|`compilerVersion`
|Compiler version, e.g. 3.2

|====

==== Definition of External Dependencies (ExternalDependencies)

The element `ExternalDependencies` is optionally present. It contains a list of external dependencies (element `ExternalDependency`), e.g. external libraries not contained in the FMU.

Element "*ExternalDependencies*" of `CoSimulation` is defined as:

image::images/ExternalDependencies_schema.png[]

Element `ExternalDependencies` contains 1..n elements `ExternalDependency`
The attributes of element "*ExternalDependency*" have the following meaning (all attributes are optional with exception of `name`):

[cols="1,1",options="header"]
|====
|Attribute Name
|_Description_

|`name`
|Name of the library to be linked with, to be found in the platform/compiler directories of the FMU.

|`type`
|Predefined names: "license", "staticLibrary", "dynamicLibrary", "dataFile",  other, ...

|`uri`
|TBD

|`description`
|TBD

|`platform`
|Platform name, e.g. x86_64-windows, i686-linux,...

|====

Element `ExternalDependency` optioally contains an element `VendorAnnotations` with tool specific data.



==== Example XML Description File

The example below is the same one as shown in <<xml-example-model-exchange>> for a ModelExchange FMU.
The only difference is the replacement of element ModelExchange by element CoSimulation (with additional attributes) and the removal of local variables, which are associated with continuous states and their derivatives.
The XML file may have the following content:

[source, xml]
----
include::examples/co_simulation.xml[]
----
